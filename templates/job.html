{% extends "base.html" %}
{% block content %}
<h2 class="mb-4 text-center" style="color:#1760a5;">ğŸŒ¸ {{ job }} ğŸŒ¸</h2>

<form method="post">
  <table class="table table-bordered table-hover align-middle text-center shadow-sm" style="background-color:#fffafc;">
    <thead style="background-color:#fcd2e7; color:rgb(13, 35, 107);">
      <tr>
        <th>åå­—</th>
        <th>åˆ†çµ„</th>
        <th>éšŠä¼</th>
        <th>ç‹€æ…‹</th>
        <th>å‚™è¨»</th>
      </tr>
    </thead>
    <tbody>
      {% for player in players %}
      <tr>
        <!-- åå­— -->
        <td><span class="fw-bold text-primary">{{ player.player_name }}</span></td>

        <!-- åˆ†çµ„é¡è‰²æ¨™ç±¤ + ä¸‹æ‹‰ -->
        <td>
          {% if player.group_name == "ç´…å¡µæ‹†å¡”" %}
            <span class="badge rounded-pill bg-danger">{{ player.group_name }}</span>
          {% elif player.group_name == "å°å´´å¤§åœ˜" %}
            <span class="badge rounded-pill bg-primary">{{ player.group_name }}</span>
          {% elif player.group_name == "æ­¥æ­¥æ©Ÿå‹•" %}
            <span class="badge rounded-pill bg-warning text-dark">{{ player.group_name }}</span>
          {% else %}
            <span class="badge rounded-pill bg-secondary">æœªåˆ†çµ„</span>
          {% endif %}
          <select class="form-select form-select-sm mt-1" name="group_name_{{ player.id }}">
            <option value="" {% if not player.group_name %}selected{% endif %}>æœªåˆ†çµ„</option>
            <option value="ç´…å¡µæ‹†å¡”" {% if player.group_name == "ç´…å¡µæ‹†å¡”" %}selected{% endif %}>ç´…å¡µæ‹†å¡”</option>
            <option value="å°å´´å¤§åœ˜" {% if player.group_name == "å°å´´å¤§åœ˜" %}selected{% endif %}>å°å´´å¤§åœ˜</option>
            <option value="æ­¥æ­¥æ©Ÿå‹•" {% if player.group_name == "æ­¥æ­¥æ©Ÿå‹•" %}selected{% endif %}>æ­¥æ­¥æ©Ÿå‹•</option>
          </select>
        </td>

        <!-- éšŠä¼é¡è‰²æ¨™ç±¤ + ä¸‹æ‹‰ -->
        <td>
          {% if player.team_name == "ç¬¬ä¸€éšŠ" %}
            <span class="badge rounded-pill bg-success">{{ player.team_name }}</span>
          {% elif player.team_name == "ç¬¬äºŒéšŠ" %}
            <span class="badge rounded-pill bg-info text-dark">{{ player.team_name }}</span>
          {% elif player.team_name == "ç¬¬ä¸‰éšŠ" %}
            <span class="badge rounded-pill bg-dark">{{ player.team_name }}</span>
          {% elif player.team_name == "ç¬¬å››éšŠ" %}
            <span class="badge rounded-pill bg-secondary">{{ player.team_name }}</span>
          {% elif player.team_name == "ç¬¬äº”éšŠ" %}
            <span class="badge rounded-pill bg-warning text-dark">{{ player.team_name }}</span>
          {% else %}
            <span class="badge rounded-pill bg-light text-dark">æœªåˆ†éšŠ</span>
          {% endif %}
          <select class="form-select form-select-sm mt-1" name="team_name_{{ player.id }}">
            <option value="" {% if not player.team_name %}selected{% endif %}>æœªåˆ†éšŠ</option>
            <option value="ç¬¬ä¸€éšŠ" {% if player.team_name == "ç¬¬ä¸€éšŠ" %}selected{% endif %}>ç¬¬ä¸€éšŠ</option>
            <option value="ç¬¬äºŒéšŠ" {% if player.team_name == "ç¬¬äºŒéšŠ" %}selected{% endif %}>ç¬¬äºŒéšŠ</option>
            <option value="ç¬¬ä¸‰éšŠ" {% if player.team_name == "ç¬¬ä¸‰éšŠ" %}selected{% endif %}>ç¬¬ä¸‰éšŠ</option>
            <option value="ç¬¬å››éšŠ" {% if player.team_name == "ç¬¬å››éšŠ" %}selected{% endif %}>ç¬¬å››éšŠ</option>
            <option value="ç¬¬äº”éšŠ" {% if player.team_name == "ç¬¬äº”éšŠ" %}selected{% endif %}>ç¬¬äº”éšŠ</option>
          </select>
        </td>

        <!-- ç‹€æ…‹åˆ‡æ› -->
        <td>
          <button type="button"
                  class="btn btn-sm rounded-pill {% if player.can_fight %}btn-success{% else %}btn-secondary{% endif %} toggle-btn"
                  data-id="{{ player.id }}">
            {% if player.can_fight %}èƒ½æ‰“{% else %}è«‹å‡{% endif %}
          </button>
        </td>

        <!-- å‚™è¨» -->
        <td>
          <input type="text" class="form-control form-control-sm rounded-pill"
                 name="role_note_{{ player.id }}"
                 value="{{ player.role_note or '' }}">
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- å„²å­˜æŒ‰éˆ• -->
  <div class="text-end mt-4 mb-5"> <!-- ç•™ç©ºé–“é¿å…è²¼æ­»åº•éƒ¨ -->
    <button type="submit" class="btn btn-lg rounded-pill"
            style="background-color:#fcd2e7; color:rgb(13, 35, 107); transition:0.3s;">
      ğŸ’¾ å„²å­˜å…¨éƒ¨
    </button>
  </div>
</form>

<script>
document.querySelectorAll(".toggle-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    const playerId = this.dataset.id;
    fetch(`/toggle/${playerId}`, {method: "POST"})
      .then(response => response.json())
      .then(data => {
        if (data.can_fight) {
          this.classList.remove("btn-secondary");
          this.classList.add("btn-success");
          this.textContent = "èƒ½æ‰“";
        } else {
          this.classList.remove("btn-success");
          this.classList.add("btn-secondary");
          this.textContent = "è«‹å‡";
        }
      });
  });
});

// hover æ•ˆæœï¼šå„²å­˜æŒ‰éˆ•æ»‘éå»è®Šæ·±ç²‰è‰²
document.querySelector("button[type='submit']").addEventListener("mouseover", function() {
  this.style.backgroundColor = "#f7a9c4";
});
document.querySelector("button[type='submit']").addEventListener("mouseout", function() {
  this.style.backgroundColor = "#fcd2e7";
});
</script>
{% endblock %}