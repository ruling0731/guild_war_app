{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">ç·¨è¼¯ç©å®¶è³‡æ–™</h2>

<div class="card p-4 shadow-sm">
  <!-- åå­— -->
  <div class="mb-3">
    <label class="form-label fw-bold">åå­—</label>
    <input type="text" class="form-control" value="{{ player.player_name }}" disabled>
  </div>

  <!-- åˆ†çµ„ -->
  <form method="post">
    <div class="mb-3">
      <label class="form-label fw-bold">åˆ†çµ„</label>
      <select class="form-select" name="group_name">
        <option value="" {% if not player.group_name %}selected{% endif %}>æœªåˆ†çµ„</option>
        <option value="ç´…å¡µæ‹†å¡”" {% if player.group_name == "ç´…å¡µæ‹†å¡”" %}selected{% endif %}>ç´…å¡µæ‹†å¡”</option>
        <option value="å°å´´å¤§åœ˜" {% if player.group_name == "å°å´´å¤§åœ˜" %}selected{% endif %}>å°å´´å¤§åœ˜</option>
        <option value="æ­¥æ­¥æ©Ÿå‹•" {% if player.group_name == "æ­¥æ­¥æ©Ÿå‹•" %}selected{% endif %}>æ­¥æ­¥æ©Ÿå‹•</option>
      </select>
    </div>

    <!-- éšŠä¼ -->
    <div class="mb-3">
      <label class="form-label fw-bold">éšŠä¼</label>
      <select class="form-select" name="team_name">
        <option value="" {% if not player.team_name %}selected{% endif %}>æœªåˆ†éšŠ</option>
        <option value="ç¬¬ä¸€éšŠ" {% if player.team_name == "ç¬¬ä¸€éšŠ" %}selected{% endif %}>ç¬¬ä¸€éšŠ</option>
        <option value="ç¬¬äºŒéšŠ" {% if player.team_name == "ç¬¬äºŒéšŠ" %}selected{% endif %}>ç¬¬äºŒéšŠ</option>
        <option value="ç¬¬ä¸‰éšŠ" {% if player.team_name == "ç¬¬ä¸‰éšŠ" %}selected{% endif %}>ç¬¬ä¸‰éšŠ</option>
        <option value="ç¬¬å››éšŠ" {% if player.team_name == "ç¬¬å››éšŠ" %}selected{% endif %}>ç¬¬å››éšŠ</option>
        <option value="ç¬¬äº”éšŠ" {% if player.team_name == "ç¬¬äº”éšŠ" %}selected{% endif %}>ç¬¬äº”éšŠ</option>
      </select>
    </div>

    <!-- å‚™è¨» -->
    <div class="mb-3">
      <label class="form-label fw-bold">å‚™è¨»</label>
      <input type="text" class="form-control" name="role_note" value="{{ player.role_note or '' }}">
    </div>

    <!-- å„²å­˜ / è¿”å› -->
    <div class="d-flex justify-content-between mt-4">
      <a href="{{ url_for('job_page', job=player.job) }}" class="btn btn-outline-secondary">è¿”å›</a>
      <button type="submit" class="btn btn-primary">ğŸ’¾ å„²å­˜</button>
    </div>
  </form>

  <!-- ç‹€æ…‹åˆ‡æ› -->
  <div class="mt-4">
    <label class="form-label fw-bold">ç‹€æ…‹</label><br>
    <button class="btn {% if player.can_fight %}btn-success{% else %}btn-secondary{% endif %}"
            id="toggle-btn">
      {% if player.can_fight %}èƒ½æ‰“{% else %}è«‹å‡{% endif %}
    </button>
  </div>
</div>

<script>
document.getElementById("toggle-btn").addEventListener("click", function() {
  fetch("/toggle/{{ player.id }}", {method: "POST"})
    .then(response => response.json())
    .then(data => {
      if (data.can_fight) {
        this.classList.remove("btn-secondary");
        this.classList.add("btn-success");
        this.textContent = "èƒ½æ‰“";
      } else {
        this.classList.remove("btn-success");
        this.classList.add("btn-secondary");
        this.textContent = "è«‹å‡";
      }
    });
});
</script>
{% endblock %}